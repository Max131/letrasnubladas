---
import { getCollection, render } from "astro:content";
import { getFormatedDate } from "@utils/index.ts";
import Layout from "@layouts/Default.astro";
import PostImage from "@components/PostImage.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id.match(/[a-zA-Z].+/)[0] },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout
  title={post.data.title}
  description={post.data.excerpt}
  classes="post-page"
>
  <!-- <a class="post-link-back" href="/">&larr; Inicio</a> -->
  <article class={post.data.category}>
    <header>
      <h1>{post.data.title}</h1>
      <p>Por {post.data.author}</p>
      <time datetime={`${post.id.match(/^\d{4}-\d{2}-\d{2}/)[0]}`}>
        {getFormatedDate(post.id.match(/^\d{4}-\d{2}-\d{2}/)[0])}
      </time>
    </header>
    <div>
      {
        post.data.image && (
          <PostImage image={post.data.image} alt={post.data.title} />
        )
      }
      <Content />
    </div>
  </article>
</Layout>

<style>
  header {
    margin-block: 1rem 5rem;
  }

  h1 {
    position: relative;
    margin-top: 0;
    font-size: 3rem;
    line-height: 1;
    max-width: fit-content;
    margin-inline: auto;

    &::after {
      content: "";
      position: absolute;
      left: 50%;
      translate: -50% 0;
      bottom: -0.75rem;
      width: 60%;
      height: 1px;
      background-color: color-mix(in srgb, var(--text-color), transparent 70%);
    }
  }

  p {
    position: relative;
    margin-block: 1.5rem;
    font-size: 1rem;
    font-style: italic;
    font-weight: 100;
    max-width: fit-content;
    margin-inline: auto;

    &::after {
      content: "";
      position: absolute;
      left: 50%;
      translate: -50% 0;
      bottom: -0.5rem;
      width: 60%;
      height: 1px;
      background-color: color-mix(in srgb, var(--text-color), transparent 70%);
    }
  }

  time {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* a {
    display: inline-block;
    text-decoration: none;
    padding: 0.5rem 1rem;
    background-color: var(--button-bg-color);
    border-radius: var(--rounded);
    transition: background-color 0.3s ease;

    &:hover {
      background-color: color-mix(
        in srgb,
        var(--button-bg-color),
        var(--text-color) 20%
      );
    }
  } */
</style>
