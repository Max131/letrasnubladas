---
import { getCollection, render } from "astro:content";
import { Printer, Share2 } from "@lucide/astro";
import { getFormatedDate } from "@utils/index.ts";
import { normalizeString } from "@utils/index.ts";
import Layout from "@layouts/Default.astro";
import PostImage from "@components/PostImage.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id.match(/[a-zA-Z].+/)[0] },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout
  title={post.data.title}
  description={post.data.excerpt}
  classes="post-page"
>
  <article class={`post-content ${normalizeString(post.data.category)}`}>
    <header>
      <h1 transition:name={post.data.title}>{post.data.title}</h1>
      <p>
        {post.data.category} por {post.data.author}
        <span class="print-url"> en letrasnubladas.com</span>
      </p>
      <time datetime={`${post.id.match(/^\d{4}-\d{2}-\d{2}/)[0]}`}>
        {getFormatedDate(post.id.match(/^\d{4}-\d{2}-\d{2}/)[0])}
      </time>
    </header>
    <div class="post-body">
      {
        post.data.image && (
          <PostImage image={post.data.image} alt={post.data.title} />
        )
      }
      <Content />
    </div>
    <div class="buttons">
      <button data-share>
        <Share2 size={16} />
        Compartir
      </button>
      <button data-print>
        <Printer size={16} />
        Imprimir
      </button>
    </div>
  </article>
</Layout>

<style>
  header {
    margin-block: 1rem 5rem;
  }

  h1 {
    margin-block: 0;
    font-size: clamp(2rem, 1rem + 4vw, 3rem);
    line-height: 1;
    max-width: fit-content;
    margin-inline: auto;
  }

  p {
    position: relative;
    margin-block: 0.75rem 0;
    text-transform: uppercase;
    font-size: small;
    font-weight: 500;
    max-width: fit-content;
    margin-inline: auto;

    &::after {
      content: "";
      position: absolute;
      left: 50%;
      translate: -50% 0;
      bottom: -0.5rem;
      width: 60%;
      height: 4px;
      background-color: color-mix(in srgb, var(--text-color), transparent 70%);
    }
  }

  time {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;

    @media print {
      display: block;
      position: static;
      width: fit-content;
      height: auto;
      margin: 0.25rem auto;
      overflow: visible;
      clip: auto;
      white-space: normal;
      font-size: small;
    }
  }

  .buttons {
    display: flex;
    gap: 1rem;
    margin-block: 5rem 3rem;
  }

  button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: none;
    border-radius: var(--rounded-sm);
    padding: 0.5rem 0.5rem;
    background: var(--button-bg-color);
    cursor: pointer;

    @media print {
      display: none;
    }
  }

  .print-url {
    display: none;

    @media print {
      display: inline;
    }
  }
</style>
